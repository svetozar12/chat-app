FROM node:18-alpine as deps
WORKDIR /app

COPY . .

RUN yarn --frozen-lockfile
RUN yarn build

FROM node:18-alpine as runner 

ENV NODE_ENV="production"
ENV API_URL="http://chat.gospodinovs.com/api"
ENV PORT=4003
ENV DEBUG=false

WORKDIR /app

COPY --from=deps /app/dist ./dist
COPY --from=deps /app/package.json ./package.json


RUN yarn install --production --frozen-lockfile

EXPOSE 4003

CMD ["yarn","start"]